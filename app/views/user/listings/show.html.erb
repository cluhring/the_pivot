<div class="listing-show-page">
  <div class="row">
    <div class="col-lg-6"></div>
    <h1 class="listing-header"><%= @listing.title %></h1>
  </div>
  <div class="row user-show-row">
    <div class="col-md-12 filter">
      <div class="form-inline show-search">
        <%= bootstrap_form_tag url: "/carts", method: "post" do |f| %>
          <%= f.text_field :check_in, hide_label: true, placeholder: "Check In", class: "from_date connector", contenteditable: false, required: true %>
          <%= f.text_field :check_out, hide_label: true, placeholder: "Check Out", class: "to_date connector", contenteditable: false, required: true %>
          <%= f.hidden_field :listing_id, value: @listing.id %>
          <%= f.submit "Book It!", class: "btn btn-primary connector" %>
        <% end %>
      </div>
      <div class="col-lg-5 user-listing-show">
        <%= image_tag @listing.listing_images.first.image.hero.url, class: "img-responsive" if @listing.listing_images.any? %>
        <%= render partial: "listing_show", locals: {listing: @listing, images: @listing_images} %>
        <section id="networks">
          <div class="col-lg-0">
            <p>
              <a href="#"><i class="facebook fa fa-facebook"></i></a><a href="#"><i class="twitter fa fa-twitter"></i></a><a href="#"><i class="mail fa fa-envelope"></i></a>
            </p>
          </div>
        </section>
      </div>
      <div id='map' class="col-lg-7 user-listing-show"></div>
        <script>
          L.mapbox.accessToken = 'pk.eyJ1IjoiY2x1aHJpbmciLCJhIjoiNWF2Z1l6ZyJ9.8peAq7kTQyvXShlVv1K82w';
          var map = L.mapbox.map('map', 'cluhring.e6c29d77');

          // map.locate();
          map.locate({setView: false, maxZoom: 16});

          function onLocationFound(e) {
            var radius = e.accuracy / 2;
            var current_lat = e.latlng.lat;
            var current_long = e.latlng.lng;
            var ctrl = L.Routing.control({
              waypoints: [
                L.latLng (e.latlng.lat, e.latlng.lng),
                L.latLng (<%= @listing.latitude ||= 39.749747 %>, <%= @listing.longitude ||= -104.999977 %>)
              ],
              routeWhileDragging: true,
              draggableWaypoints: true,
              autoRoute: true,
              fitSelectedRoutes: 'smart',
              geocoder: L.Control.Geocoder.nominatim()
            }).addTo(map);

            L.marker(e.latlng).addTo(map)
            .bindPopup("You are here").openPopup();

            L.circle(e.latlng, radius).addTo(map);
          }

          map.on('locationfound', onLocationFound);
        </script>
        </div>
      </div>
    </div>
  </div>
</div>
